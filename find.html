<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»ˆç„‰æœç´¢ - æœ«æ—¥æ•°å­—å¢“ç¢‘æ£€ç´¢</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”</text></svg>">
</head>
<body class="terminal-flash">
    <!-- æ‰«æçº¿ -->
    <div class="scanline"></div>
    
    <!-- è¡€è‰²æ»´è½æ•ˆæœ -->
    <div class="blood-drip" style="left: 15%; animation-delay: 0.5s;"></div>
    <div class="blood-drip" style="left: 45%; animation-delay: 2.5s;"></div>
    <div class="blood-drip" style="left: 75%; animation-delay: 4.5s;"></div>
    
    <div class="container distort-container">
        <header class="header">
            <h1 class="glitch-text">
                <span class="character">ç»ˆ</span>
                <span class="character">ç„‰</span>
                <span class="terminal-tremble">æœ</span>
                <span class="terminal-tremble">ç´¢</span>
                <span class="character">ä¸­</span>
                <span class="character">å¿ƒ</span>
            </h1>
            <p class="subtitle flicker">æ¨¡ç³Šæœç´¢ç»ˆç„‰è®°å½• | ä½“éªŒæœ«æ—¥æ•°æ®æ£€ç´¢</p>
        </header>

        <main class="content">
            <div class="form-container">
                <div class="form-group">
                    <label for="searchInput">æœç´¢ç»ˆç„‰ä¿¡æ¯</label>
                    <input type="text" id="searchInput" 
                           placeholder="è¾“å…¥åŸŸåã€ç»ˆç„‰å®ä½“æˆ–æœ«æ—¥æè¿°å…³é”®è¯...">
                    <span class="error-text">ç»ˆç„‰å·²è‡³ï¼Œè®°å½•å°†æ°¸è¿œç•™å­˜</span>
                </div>
                <button onclick="searchICP()" class="btn btn-search" style="width: 100%;">
                    <span class="terminal-tremble">å¼€ å§‹ ç»ˆ ç„‰ æœ ç´¢</span>
                </button>
            </div>

            <div id="searchResults" class="search-results"></div>

            <div id="detailView" style="display: none;">
                <div class="icp-display">
                    <h3 id="detailTitle"></h3>
                    <div id="detailContent"></div>
                    <div id="detailCode" class="code-block" style="display: none;"></div>
                    <button onclick="showSearch()" class="btn btn-search" style="margin-top: 20px;">
                        <span class="terminal-tremble">è¿”å›ç»ˆç„‰æœç´¢ç»“æœ</span>
                    </button>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <a href="ICP.html" class="btn btn-search">è¿”å›ç»ˆç„‰é¦–é¡µ</a>
                <a href="signup.html" class="btn btn-register">æ³¨å†Œæ–°ç»ˆç„‰</a>
            </div>
        </main>

        <footer class="footer">
            <p>ç»ˆç„‰å¤‡æ¡ˆç³»ç»Ÿ | æœ«æ—¥æœç´¢é¡µé¢ | Â© ç»ˆç„‰çºªå…ƒ æ•°å­—å´©æºƒå®¡åˆ¤åº­</p>
        </footer>
    </div>

    <!-- ç»ˆç„‰è®¡æ•° -->
    <div class="terminal-count" id="terminalCount">0000</div>

    <script src="app.js"></script>
    <script>
        let allRecords = [];
        
        // æ›´æ–°ç»ˆç„‰è®¡æ•°
        function updateTerminalCount() {
            const count = Math.floor(Math.random() * 10000);
            document.getElementById('terminalCount').textContent = 
                count.toString().padStart(4, '0');
            setTimeout(updateTerminalCount, 2000 + Math.random() * 3000);
        }
        
        document.addEventListener('DOMContentLoaded', updateTerminalCount);

        async function searchICP() {
            const query = document.getElementById('searchInput').value.trim();
            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '<div class="loading"></div> <span class="terminal-tremble">ç»ˆç„‰æœç´¢ä¸­...</span>';

            try {
                // ä»GitHubè·å–æ‰€æœ‰ç»ˆç„‰è®°å½•
                const records = await getAllICPRecords();
                allRecords = records;
                
                if (!records || records.length === 0) {
                    resultsDiv.innerHTML = '<div class="error-message">æœªæ‰¾åˆ°ä»»ä½•ç»ˆç„‰è®°å½•</div>';
                    return;
                }

                const filtered = records.filter(record => {
                    if (!query) return true;
                    
                    const searchStr = query.toLowerCase();
                    return (
                        (record.domain && record.domain.toLowerCase().includes(searchStr)) ||
                        (record.company && record.company.toLowerCase().includes(searchStr)) ||
                        (record.description && record.description.toLowerCase().includes(searchStr)) ||
                        (record.purpose && record.purpose.toLowerCase().includes(searchStr))
                    );
                });

                if (filtered.length === 0) {
                    resultsDiv.innerHTML = '<div class="error-message">æœªæ‰¾åˆ°åŒ¹é…çš„ç»ˆç„‰è®°å½•</div>';
                    return;
                }

                resultsDiv.innerHTML = `<h3 class="bleed-text" data-text="æ‰¾åˆ°${filtered.length}ä¸ªç»ˆç„‰">æ‰¾åˆ° ${filtered.length} ä¸ªç»ˆç„‰ï¼š</h3>`;
                
                filtered.forEach((record, index) => {
                    const item = document.createElement('div');
                    item.className = 'result-item';
                    item.innerHTML = `
                        <h3>${record.domain || 'æœªå‘½åç»ˆç„‰'}</h3>
                        <p>æœ«æ—¥ç”¨é€”ï¼š${record.purpose || 'æœªæŒ‡å®š'}</p>
                        <p>ç»ˆç„‰å®ä½“ï¼š${record.company || 'æœªæä¾›'}</p>
                        <div class="result-meta">
                            <span>ç»ˆç„‰å¤‡æ¡ˆå·ï¼š${record.icpNumber || 'æœªç”Ÿæˆ'}</span>
                            <span>å®¡åˆ¤æ—¶é—´ï¼š${record.date || 'æœªçŸ¥'}</span>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9rem; opacity: 0.6;">
                            ç‚¹å‡»æŸ¥çœ‹ç»ˆç„‰è¯¦æƒ…
                        </div>
                    `;
                    item.onclick = () => showDetail(record);
                    resultsDiv.appendChild(item);
                });

            } catch (error) {
                resultsDiv.innerHTML = `<div class="error-message">ç»ˆç„‰æœç´¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }

        function showDetail(record) {
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('detailView').style.display = 'block';
            
            document.getElementById('detailTitle').innerHTML = 
                `<span class="terminal-tremble">${record.domain}</span> çš„ç»ˆç„‰ä¿¡æ¯`;
            
            let details = `
                <div class="icp-details">
                    <div class="detail-item">
                        <div class="detail-label">ç»ˆç„‰åŸŸå</div>
                        <div class="detail-value">${record.domain || 'æœªæä¾›'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">ç»ˆç„‰å¤‡æ¡ˆå·</div>
                        <div class="detail-value">${record.icpNumber || 'æœªç”Ÿæˆ'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">æœ«æ—¥ç”¨é€”</div>
                        <div class="detail-value">${record.purpose || 'æœªæŒ‡å®š'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">ç»ˆç„‰å®ä½“</div>
                        <div class="detail-value">${record.company || 'æœªæä¾›'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">æœ«æ—¥è”ç³»æ–¹å¼</div>
                        <div class="detail-value">${record.contact || 'æœªæä¾›'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">å®¡åˆ¤æ—¶é—´</div>
                        <div class="detail-value">${record.date || 'æœªçŸ¥'}</div>
                    </div>
                </div>
            `;
            
            if (record.description) {
                details += `
                    <div style="margin-top: 20px;">
                        <div class="detail-label">ç»ˆç„‰æè¿°</div>
                        <p style="margin-top: 10px; padding: 15px; background-color: rgba(255,0,0,0.1); border-left: 3px solid #ff0000;">
                            ${record.description}
                        </p>
                    </div>
                `;
            }
            
            if (record.url) {
                details += `
                    <div style="margin-top: 20px; text-align: center;">
                        <a href="${record.url}" target="_blank" class="btn btn-register">
                            æŸ¥çœ‹ç»ˆç„‰å¢“ç¢‘é¡µé¢
                        </a>
                    </div>
                `;
            }
            
            document.getElementById('detailContent').innerHTML = details;
        }

        function showSearch() {
            document.getElementById('detailView').style.display = 'none';
            document.getElementById('searchResults').style.display = 'block';
        }
    </script>
</body>
</html>